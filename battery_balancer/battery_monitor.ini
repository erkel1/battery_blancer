; Battery Monitor Configuration File (battery_monitor.ini)
; Updated as of August 21, 2025.
; This INI file configures the combined battery temperature monitoring and balancing script for a 3s8p battery system (3 series-connected parallel battery banks, each with 8 cells).
; It merges settings from the original balancer and temperature scripts, with temperature-specific params in [Temp] and shared/general in [General].
; Sections:
; - [Temp]: Settings for temperature monitoring via Modbus over TCP (Lantronix EDS4100 device with NTC sensors).
; - [General]: Shared settings for balancing, polling, voltage thresholds, alarms, etc.
; - [I2C]: Addresses for I2C devices (multiplexer for channel select, ADC for voltage, relays for balancing).
; - [GPIO]: GPIO pins on Raspberry Pi for DC-DC converter control and alarm relay.
; - [Email]: Settings for SMTP email alerts on critical voltage/temp issues (throttled to prevent spam).f
; - [ADC]: Configuration registers and bitmasks for the ADS1115 ADC (advanced; rarely change).
; - [Calibration]: Per-sensor calibration multipliers for voltage readings (tune based on measured vs actual).
; - [Startup]: Settings for the startup self-test (balancer verification, etc.).
; - [Web]: Settings for the web interface (host, port, auth, etc.).

; Usage Notes:
; - All values have fallbacks in the script, so missing keys use defaults (listed below).
; - Types: string (text), integer (whole number), float (decimal, e.g., 0.1).
; - Thresholds: Tune to your battery type (e.g., LiFePO4: ~3.0-3.65V per cell, temps <60째C high, >0째C low).
; - For temps: 24 channels (8 per bank), scaling_factor assumes raw * scaling = 째C (e.g., 100 for 0.01째C units).
; - For voltages: 3 banks, divider ratio = R2/(R1+R2) from circuit.
; - Email: Use app-specific password if 2FA enabled; test SMTP separately.
; - Logging: Set level in [General] (DEBUG for verbose, INFO default).
; - Changes require script restart; validate hardware matches (e.g., I2C addresses).
; - Script warns if NumberOfBatteries != 3 (hardcoded NUM_BANKS).
; - Web: Optional interface for remote monitoring/balancing; requires auth if enabled.

[Temp]
ip = 192.168.15.240
port = 10001
poll_interval = 10.0
rise_threshold = 2.0
deviation_threshold = 0.1
disconnection_lag_threshold = 0.5
high_threshold = 60.0
low_threshold = 0.0
scaling_factor = 100.0
valid_min = 0.0
max_retries = 3
retry_backoff_base = 1
query_delay = 0.5
num_channels = 24
abs_deviation_threshold = 2.0

[General]
NumberOfBatteries = 3
VoltageDifferenceToBalance = 0.1
BalanceDurationSeconds = 5
SleepTimeBetweenChecks = 0.1
BalanceRestPeriodSeconds = 60
LowVoltageThresholdPerBattery = 18.5
HighVoltageThresholdPerBattery = 21.0
EmailAlertIntervalSeconds = 3600
I2C_BusNumber = 1
VoltageDividerRatio = 0.01592
LoggingLevel = INFO
WebInterfaceEnabled = true
StartupSelfTestEnabled = true

[I2C]
MultiplexerAddress = 0x70
VoltageMeterAddress = 0x49
RelayAddress = 0x26

[GPIO]
DC_DC_RelayPin = 17
AlarmRelayPin = 27

[Email]
SMTP_Server = smtp.gmail.com
SMTP_Port = 587
SenderEmail = your_email@gmail.com
RecipientEmail = recipient@example.com
SMTP_Username = your_email@gmail.com
SMTP_Password = your_app_password

[ADC]
ConfigRegister = 0x01
ConversionRegister = 0x00
ContinuousModeConfig = 0x0100
SampleRateConfig = 0x0080
GainConfig = 0x0400

[Calibration]
Sensor1_Calibration = 0.99856
Sensor2_Calibration = 0.99856
Sensor3_Calibration = 0.99809

[Startup]
test_balance_duration = 15
min_voltage_delta = 0.01
test_read_interval = 2

[Web]
host = 0.0.0.0
port = 8080
auth_required = false
username = admin
password = admin123
api_enabled = true
cors_enabled = true
cors_origins = *